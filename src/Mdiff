#!/bin/ksh -p
# $Id: Mdiff,v 1.3 1998/01/09 13:15:27 archiv Exp $
# Author: J.E. Wulff
#
case $# in
0)  echo "Usage:	$0 [-ei] [+w] [directory] file ..." >&2
    echo '	-i	identical files output:	==== file ====' >&2
    echo '		default: ignore identical files in output' >&2
    echo '	-e	nonexisting files put:	**** file does not exist' >&2
    echo '		default: ignore nonexisting files in output' >&2
    echo '	if both files exist output:	#### file ####' >&2
    echo '	+w	whitespace (spaces and tabs) is significant' >&2
    echo '		default: whitespace is ignored' >&2
    echo '	if first file argument is not a directory, .. is used' >&2
    exit 1
    ;;
*)
    i=0
    e=0
    w=-w
    while true
    do
	case $1 in
	-e)
	    e=1
	    shift
	    ;;
	-i)
	    i=1
	    shift
	    ;;
	-ei|-ie)
	    e=1
	    i=1
	    shift
	    ;;
	+w)
	    w=
	    shift
	    ;;
	[+-]*)
	    echo "$0: unexpected argument $1"
	    exit 2
	    ;;
	*)
	    break
	    ;;
	esac
    done
    if [ -d $1 ]
    then
	dir=$1
	shift
    else
	dir=..
    fi
    if [ $# = 0 ]
    then
	files='*.[chv]* [Mm]akefile'
    else
	files=$*
    fi
    echo "Differences in directory $PWD and $dir"
    date
    for f in $files
    do
	if [ $e != 0 ] || [ -f $dir/$f ]
	then
	    if cmp -s $f $dir/$f
	    then
		test $i = 0 || echo "========== $f =========="
	    else
		if [ $e = 0 ] || [ -f $dir/$f ]
		then
		    echo
		    echo "########## $f ##########"
		    ls -lL $f
		    ls -lL $dir/$f
		    diff $w $f $dir
		else
		    echo "********** $dir/$f does not exist"
		fi
	    fi
	fi
    done
    ;;
esac
