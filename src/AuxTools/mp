#!/usr/bin/ksh -p

########################################################################
#
#	make OutP in test icc
#
########################################################################

test -d ListP || mkdir ListP;

if [[ $# != 0 ]]; then
    for f in $*; do
	echo "$f.ic";
	icc -c $f.ic > /dev/null 2>&1		# listing only with -d474
	cd ..
	rm -f cexe.o icc	# new cexe.o too soon for make sometimes
	make icc 2>&1 | grep -iE '(error|warning|:[0-9]+:)'
	cd - > /dev/null
	if [[ -f ../icc ]]; then	# use locally generated compiler
	    ../icc -d474 -l ListP/$f.lst $f.ic;
	else
	    echo make icc failed
	fi
    done
else
    for f in $(cat pe.lst); do
	echo "$f.ic";
	icc -c $f.ic > /dev/null 2>&1		# listing only with -d474
	cd ..
	rm -f cexe.o icc	# new cexe.c too soon for make sometimes
	make icc 2>&1 | grep -iE '(error|warning|:[0-9]+:)'
	cd - > /dev/null
	if [[ -f ../icc ]]; then	# use locally generated compiler
	    ../icc -d474 -l ListP/$f.lst $f.ic;
	else
	    echo make icc failed
	fi
    done > OutP 2>&1;
    icc -c < /dev/null			# restore plain icc
    cd ..
    rm -f cexe.o icc	# new cexe.c too soon for make sometimes
    make icc 2>&1 | grep -iE '(error|warning|:[0-9]+:)'
    cd - > /dev/null
fi
