#!/bin/bash

########################################################################
#
#	tt - regression tests for iC
#
########################################################################

if [ -n "$1" ]; then
    echo "##### Test0 make test"
    time make test

    t=Test1
    if [ -d "$t" ]; then
	cd $t
	if [ -d "$1" ]; then
	    echo "##### $t mm"
	    time mm > Init.out 2>&1
	    time Mdiff -kl $(cat pd.lt) $1
	fi
	if [ -d "${1}_20000" ]; then
	    echo "##### $t mm -y20000"
	    time mm -y20000 > Init.out 2>&1
	    time Mdiff -kl $(cat pd.lt) "${1}_20000"
	fi
	cd ..
    fi

    for t in Test2 Test3 Test4 Test5 Test6 Test7 Test8 Test9; do
	if [ -d "$t" ]; then
	    cd $t
	    if [ -d "$1" ]; then
		echo "##### $t my"
		time my
		time Mdiff -kl $(cat p[d6].lt) $1
	    fi
	    if [ -d "${1}_20000" ]; then
		echo "##### $t my -y20000"
		time my -y20000
		time Mdiff -kl $(cat p[d6].lt) "${1}_20000"
	    fi
	    cd ..
	fi
    done
    echo "##### end"
else
    echo "Usage: $0 <directory>" >&2
    echo "<directory> and <directory>_20000 in" >&2
    echo "directory Test1, Test2, Test3 etc" >&2
    echo "should contain comparison data." >&2
    exit 1
fi
